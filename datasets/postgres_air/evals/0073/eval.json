{
    "database": "postgres_air",
    "question": "Which routes had the most significant improvement in on-time performance between Q1 and Q2 of 2024?",
    "query": "WITH quarter_stats AS (\n    SELECT \n        departure_airport,\n        arrival_airport,\n        CASE \n            WHEN scheduled_departure >= '2024-01-01' AND scheduled_departure < '2024-04-01' THEN 'Q1'\n            WHEN scheduled_departure >= '2024-04-01' AND scheduled_departure < '2024-07-01' THEN 'Q2'\n        END AS quarter,\n        AVG(CASE WHEN status = 'On schedule' THEN 1.0 ELSE 0.0 END) AS on_time_rate\n    FROM postgres_air.flight\n    WHERE scheduled_departure >= '2024-01-01' AND scheduled_departure < '2024-07-01'\n    GROUP BY departure_airport, arrival_airport, quarter\n)\nSELECT \n    q1.departure_airport,\n    q1.arrival_airport,\n    q1.on_time_rate AS q1_on_time_rate,\n    q2.on_time_rate AS q2_on_time_rate,\n    (q2.on_time_rate - q1.on_time_rate) AS improvement\nFROM \n    (SELECT * FROM quarter_stats WHERE quarter = 'Q1') q1\nJOIN \n    (SELECT * FROM quarter_stats WHERE quarter = 'Q2') q2\n    ON q1.departure_airport = q2.departure_airport \n   AND q1.arrival_airport = q2.arrival_airport\nORDER BY improvement DESC;"
}