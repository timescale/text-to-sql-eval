{
    "database": "postgres_air",
    "question": "Which passengers have traveled on both domestic and international flights in the same month?",
    "query": "WITH flight_details AS (\n  SELECT p.passenger_id,\n         p.first_name,\n         p.last_name,\n         date_trunc('month', f.scheduled_departure) AS flight_month,\n         CASE \n           WHEN d.iso_country = a.iso_country THEN 'domestic'\n           ELSE 'international'\n         END AS flight_type\n  FROM postgres_air.passenger p\n  JOIN postgres_air.boarding_pass b ON p.passenger_id = b.passenger_id\n  JOIN postgres_air.booking_leg bl ON b.booking_leg_id = bl.booking_leg_id\n  JOIN postgres_air.flight f ON bl.flight_id = f.flight_id\n  JOIN postgres_air.airport d ON f.departure_airport = d.airport_code\n  JOIN postgres_air.airport a ON f.arrival_airport = a.airport_code\n),\nmonthly_trips AS (\n  SELECT passenger_id,\n         first_name,\n         last_name,\n         flight_month,\n         COUNT(*) FILTER (WHERE flight_type = 'domestic') AS domestic_count,\n         COUNT(*) FILTER (WHERE flight_type = 'international') AS international_count\n  FROM flight_details\n  GROUP BY passenger_id, first_name, last_name, flight_month\n)\nSELECT passenger_id,\n       first_name,\n       last_name,\n       flight_month\nFROM monthly_trips\nWHERE domestic_count > 0\n  AND international_count > 0;\n"
}