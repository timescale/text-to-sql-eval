{
    "database": "postgres_air",
    "question": "What percentage of international flights have at least one passenger under 10 years old?",
    "query": "WITH intl_flights AS (\n    SELECT f.flight_id\n    FROM postgres_air.flight f\n    JOIN postgres_air.airport dpt ON f.departure_airport = dpt.airport_code\n    JOIN postgres_air.airport arr ON f.arrival_airport = arr.airport_code\n    WHERE dpt.intnl = true\n      AND arr.intnl = true\n),\nflights_with_child AS (\n    SELECT DISTINCT f.flight_id\n    FROM postgres_air.flight f\n    JOIN postgres_air.airport dpt ON f.departure_airport = dpt.airport_code\n    JOIN postgres_air.airport arr ON f.arrival_airport = arr.airport_code\n    JOIN postgres_air.booking_leg bl ON f.flight_id = bl.flight_id\n    JOIN postgres_air.boarding_pass bp ON bl.booking_leg_id = bp.booking_leg_id\n    JOIN postgres_air.passenger p ON bp.passenger_id = p.passenger_id\n    WHERE dpt.intnl = true\n      AND arr.intnl = true\n      AND p.age < 10\n)\nSELECT CASE WHEN total.total_count = 0 THEN 0 ELSE round(100.0 * child.child_count / total.total_count, 2) END AS percentage\nFROM (SELECT count(*) AS total_count FROM intl_flights) total,\n     (SELECT count(*) AS child_count FROM flights_with_child) child;"
}